<!DOCTYPE HTML>
<html manifest="appcache.manifest">
	<head>
		<title>Marking Calculator!</title>
		<link rel="Stylesheet" href="Style.css"> 
		<link rel="apple-touch-icon-precomposed" href="HomeIcon.png"/> 
		<link rel="apple-touch-startup-image" href="SplashScreen.png" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1" />
		<script src="jquery.js"></script>
		<script>
		var total;
		var totalInput;
		var number;
		document.ontouchmove = function(e){ e.preventDefault(); }
		function enterUsageMode() {
			total = $("#totalInput").val();
			$("#total").slideUp();
			$("h1").slideUp();
			$("p").slideUp();
			$("#usage").slideDown();
			$("#usage").focusin();
			console.log(total + " submitted as total");
			updateOutput();
		}
		
		function updateFooter() {
			$("#footer").css("top", $(window).height()-40 + "px");
		}
		
		function showHelp() {
			$("#helpView").fadeIn();
		}
		
		function showSettings() {
			$("#settingsView").fadeIn();
		}
		
		String.prototype.replaceAll = function(str1, str2, ignore) 
		{
			return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),(ignore?"gi":"g")),(typeof(str2)=="string")?str2.replace(/\$/g,"$$$$"):str2);
		}
		
		function updateOutput() {
			number = $("#realInput").val();
			if(number.split(/,/g).length > 1){
				javascript:location.reload(true);
			} else {
				if(number.split(/#/g).length > 1){
					$("#output").html("0/" + total + "<br />" + "0%");
					$("#realInput").val("");
				} else {
					//number = number.replace("*", ".");
					number = number.replaceAll("*",".");
					number = eval(number);
					if (undefined===window.number) {
						$("#output").html("0/" + total + "<br />" + "0%");
					} else {
						$("#output").html(number + "/" + total + "<br />" + Math.round(number/total*100*10)/10 + "%");
					}
				}
			}
		}
		
		$(window).resize(function() {
		  updateFooter();
		});
		
		$("document").ready(function() {
			var total = 1;
			$("#usage").hide();
			updateFooter();	
			$('#totalInput').blur(function() {
			  enterUsageMode();
			});		
		});
		
		</script>
	</head>
	<body onorientationchange="updateOrientation();">
		<h1>Marking Calculator</h1>
		<p>by Jamie McClymont. Tap the ? for help.</p>
		<div id="total" class="inputContainer">&nbsp;<label for="totalInput">Total: </label><input type="tel" id="totalInput" name="totalInput" />&nbsp;<button id="submitInput" onclick="enterUsageMode()">Go!</button></div>
		<div id="usage"><br />
		<input id="realInput" type="tel" placeholder="Enter number/addition string" onkeyup="updateOutput()"></div>
		<div id="output"></div>
		<div id="footer">
			<a href="javascript:showHelp()" id="help">
				<div width="40" height="40" class="iconArea">
					<img src="Help.png" width="25" height="25">
				</div>
			</a>
			<a href="javascript:showSettings()" id="settings">
				<div width="40" height="40" class="iconArea">
					<img src="Gear.png" width="25" height="25">
				</div>
			</a>
		</div>
		<div id="helpView" class="full">
			<table id="help">
				<tr>
					<td>Heyâ€¦</td>
					<td>Hi.</td>
				</tr>
				<tr>
					<td>Hello.</td>
					<td>Greetings!</td>
				</tr>		
				<tr>
					<td>Sup.</td>
					<td>Toilet!</td>
				</tr>			
			</table>
		</div>
		<div id="settingsView" class="full">
			Settings!
		</div>
	</body>
</html>